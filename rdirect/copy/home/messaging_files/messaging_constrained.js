(function(f,g){f.Airbnb=f.Airbnb||{};var k=f.Airbnb.Messaging={};k.ajaxUrls={};k.translations={};k.el={};k.init=function(){g(".option-list-item h4").click(function(){var p=g(this).parent(),o=p.find(".action-list-item");g(".option-list-item").removeClass("open");p.addClass("open").find(".action-list").slideDown(200).end().siblings().find(".action-list").slideUp(200);if(o.length===1){o.find("input:radio").attr("checked","checked").change()}});g(".option-list-item:first").addClass("open").find(".action-list").show();g(".action-list input:radio").change(function(){var p=g(this),o=p.parents(".action-list-item");if(p.is(":checked")){g(".action-list-item").not(o).removeClass("checked").find(".drawer").slideUp(300,function(){g(this).hide()});o.addClass("checked").find("div.drawer").slideDown(300);if(p.val()==="2"){m()}}});g(".flag-container").flagWidget({success:function(){g(this.element).fadeOut(1000)}});g("form").submit(function(){g(this).disableSubmit()});var n=g("form#message_form");n.submit(function(){var o=g(this);g(this).find(".action-list-item:not(.checked)").find("input, select, textarea").attr("disabled","disabled")});k.initCheckMinMaxNights();d();h();k.observeMessageForHelp()};k.initCheckMinMaxNights=function(){var t=g("fieldset.unavailable-partial"),r=g("#min_nights"),p=g("#max_nights"),o=g("p.nights-error");g("form#message_form").submit(function(){if(t.is(":visible")){if(!u()){n();return false}}});r.change(s);p.change(s);function n(){o.slideDown(300)}function q(){o.slideUp(300)}function s(){if(u()){q();g(this).parents(".action-list-item").find("input:disabled").removeAttr("disabled")}else{n()}}function u(){var v=parseInt(t.data("requested-nights")),x=parseInt(r.val()),w=parseInt(p.val());if(v>=x&&v<=w){return false}return true}};function d(){k.el.nights.change(function(){b();a()});k.el.startDate.change(a);k.el.priceNative.change(b)}var l=false,j=false;function m(){var n=parseInt(k.el.nights.val()),p=k.el.fieldsetAvailableSpecialOffer.parent().find("input[type='submit']");if(isNaN(n)||n<=0){k.el.nights.addClass("error");l=true}else{k.el.nights.removeClass("error");l=false;g.ajax({url:k.ajaxUrls.check_availability,data:{start_date:k.el.startDate.val(),nights:n,hosting_id:k.el.hostingId.val()},success:function(q){if(q.available===true){k.el.availabilityWarning.css("display","none").text("");j=false}else{k.el.availabilityWarning.css("display","block").text(k.translations.availability_warning);j=true}o()},dataType:"json"})}o();function o(){if(l||j){p.attr("disabled","disabled")}else{p.removeAttr("disabled")}}}function i(n){var q,o;if(n.post_id==null){q="live_help"}else{q="inline_help_"+n.post_id}if(n.kind=="Tip"){o='<img src="/images/icons/tip_icon.png" width="14" height="13" />'}else{if(n.kind=="Note"){o='<img src="/images/icons/note_icon.gif" width="13" height="11" />'}}var p=g('<div style="display: none;" id="'+q+'" class="inline_help">  		<img src="/images/icons/close_icon.png" class="close_inline_help" width="9" height="8" />  		'+o+" <b>"+n.kind+"</b><br />"+n.text+"</div>");p.find(".close_inline_help").click(function(){p.hide(200);g.post("/messaging/inline_help_ignore",{help_key:n.key});c("inline_help","hide",n.key)});p.find("a").click(function(){c("inline_help","follow_link",n.key)});return p}function c(p,q,r,n){try{_gaq.push(["_trackEvent",p,q,r])}catch(o){}}g(document).ready(function(){k.el.startDate=g("#start_date");k.el.checkoutDate=g("#checkout_date");k.el.nights=g("#nights");k.el.nightlyPrice=g("#nightly_price");k.el.priceNative=g("#price_native");k.el.hostingId=g("#hosting_id");k.el.availabilityWarning=g("#availability_warning");k.el.fieldsetAvailableSpecialOffer=g("fieldset.available-special-offer");k.init();var n=k.el.startDate.val();k.el.startDate.blur(function(o){if(k.el.startDate.val()!=n){n=k.el.startDate.val();m()}});k.el.nights.blur(m)});k.observeMessageForHelp=function(){var q=null,o;function n(){var r=g("textarea[name=message]:visible");if(r.length&&r.val().length>=10&&r.val()!==o){o=r.val();p(r)}}function p(r){g.post(k.ajaxUrls.inline_help,{message:r.val()},function(u){if(u&&u.key!=q){q=u.key;var s=g("#live_help").animate({opacity:0});var t=i(u).insertAfter(r);if(s.length){t.css("position","absolute").fadeIn(300,function(){s.remove();t.css("position","relative")})}else{t.slideDown(300)}c("inline_help","show",u.key)}},"json")}setInterval(n,4000)};function h(){g.post(k.ajaxUrls.inline_help,{},function(n){g.each(n,function(){var o=g("#question2_post_"+this.post_id+" div.inline-help-container");i(this).appendTo(o).show(200);c("inline_help","show",this.key)})},"json")}function e(n){if(Object.prototype.toString.call(n)!=="[object Date]"){return false}return !isNaN(n.getTime())}function a(){var n=jQuery.datepicker._defaults.dateFormat;var p=jQuery.datepicker.parseDate(n,k.el.startDate.val());if(!e(p)){k.el.checkoutDate.html("");return false}var o=parseInt(k.el.nights.val());if(isNaN(o)){k.el.checkoutDate.html("");return false}p.setDate(p.getDate()+o);k.el.checkoutDate.html("(check out on "+jQuery.datepicker.formatDate(n,p)+")")}function b(){var n=(k.el.priceNative.val()/k.el.nights.val()).round();k.el.nightlyPrice.html(n)}})(window,jQuery);this.tooltip=function(){xOffset=20;yOffset=20;jQuery("a.tooltip").hover(function(a){this.t=this.title;this.title="";jQuery("body").append("<p id='tooltip'>"+this.t.replace(/\n/g,"<br />")+"</p>");jQuery("#tooltip").css("top",(a.pageY-xOffset)+"px").css("left",(a.pageX+yOffset)+"px").fadeIn("fast")},function(){this.title=this.t;jQuery("#tooltip").remove()});jQuery("a.tooltip").mousemove(function(a){jQuery("#tooltip").css("top",(a.pageY-xOffset)+"px").css("left",(a.pageX+yOffset)+"px")})};jQuery(document).ready(function(){tooltip()});